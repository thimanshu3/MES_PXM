<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%=topic.name%></title>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/cards.css">
    <link rel="stylesheet" href="/css/iziToast.min.css">
    <link rel="stylesheet" href="/css/studentCdashboard.css">
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;500&display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="//www.ibm.com/favicon.ico" type="image/vnd.microsoft.icon">
</head>
<style>
    *,
    html,
    body {
        font-family: 'Comfortaa', cursive;
    }

    main {
        height: 100%;
        display: -webkit-box;
        display: flex;
        margin: 0 20px;
        text-align: center;
        -webkit-box-orient: vertical;
        -webkit-box-direction: normal;
        flex-direction: column;
        -webkit-box-align: center;
        align-items: center;
        -webkit-box-pack: center;
        justify-content: center;
    }

    main h1 {
        font-size: 3em;
        font-weight: 100;
        color: #F44;
        margin: 0;
    }

    main h2 {
        font-size: 1.5em;
        font-weight: 100;
        margin-bottom: 0;
    }

    main h3 {
        font-size: 1.5em;
        font-weight: 100;
        margin-top: 0;
    }

    main a {
        font-size: 1.5em;
        font-weight: 300;
        color: #F44;
        text-decoration: none;
    }

    footer {
        position: absolute;
        bottom: 0;
        margin: 10px;
        font-weight: 300;
    }
</style>

<body>
    <div class="app-container app-theme-white body-tabs-shadow fixed-sidebar fixed-header">
        <!-- header/ navbar area -->
        <div class="header-container light-theme">
            <div class="header">
                <div class="header__title">
                    <a class="mdl-button mdl-js-button mdl-button--icon mdl-js-ripple-effect header__button header__button--nav"
                        href="#" onclick="window.top.close()" data-upgraded=",MaterialButton,MaterialRipple">
                        <i class="fas fa-arrow-left"></i><span class="mdl-button__ripple-container"><span
                                class="mdl-ripple"></span></span>
                    </a>

                    <h1 class="headline-5">
                        <%=topic.name%>
                    </h1>
                </div>
            </div>
        </div>
        <!-- header/navbar area end -->
        <div class="app-main">
            <div class="app-main__outer pl-0">
                <div class="app-main__inner">
                    <% let n = '';
                     n = courseContent.search(/DefaulAccess/g) %>
                    <% if (n == -1) { %>
                    <div class="row">
                        <div class="col-md-3 col-xl-2 col-lg-2 col-sm-12">
                            <div class="card"
                                style="width: 100%;  position: -webkit-sticky;position: sticky; top: 80px;">
                                <div class="card-body">
                                    <button id="<%=!topic.tracking ? 'markAsCompleteBtn' : ''%>"
                                        class="btn btn-<%=!topic.tracking ? 'primary' : 'light'%> btn-block" disabled>
                                        <%=!topic.tracking ? 'Mark As Complete' : 'Already Completed'%>
                                    </button>
                                    <button style="display: none;" id="CloseBtn" class="btn btn-danger btn-block">
                                        Close This Tab
                                    </button>
                                </div>
                                <div class="card-footer d-flex justify-content-center">
                                    <div class="">
                                        <span id="counterTimer" class="text-dark" style="font-size: 28px;">00:
                                        </span>
                                    </div>
                                </div>
                                <div class="card-footer d-flex justify-content-center">
                                    <span class="text-dark" style="font-size: 13px;">Suggested read time
                                        <strong class="text-danger">
                                            <%= topic.duration %> Min
                                        </strong>
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-9 col-xl-9 col-lg-9 col-sm-12">
                            <%- courseContent %>
                        </div>
                    </div>
                    <%} else { %>
                    <main>
                        <svg xmlns="http://www.w3.org/2000/svg" width="100" height="70" viewBox="0 0 100 68">
                            <g id="large">
                                <path fill="none" stroke="#F44"
                                    d="M55.8 38.5l6.2-1.2c0-1.8-.1-3.5-.4-5.3l-6.3-.2c-.5-2-1.2-4-2.1-6l4.8-4c-.9-1.6-1.9-3-3-4.4l-5.6 3c-1.3-1.6-3-3-4.7-4.1l2-6A30 30 0 0 0 42 8l-3.3 5.4c-2-.7-4.2-1-6.2-1.2L31.3 6c-1.8 0-3.5.1-5.3.4l-.2 6.3c-2 .5-4 1.2-6 2.1l-4-4.8c-1.6.9-3 1.9-4.4 3l3 5.6c-1.6 1.3-3 3-4.1 4.7l-6-2A32.5 32.5 0 0 0 2 26l5.4 3.3c-.7 2-1 4.2-1.2 6.2L0 36.7c0 1.8.1 3.5.4 5.3l6.3.2c.5 2 1.2 4 2.1 6l-4.8 4c.9 1.6 1.9 3 3 4.4l5.6-3c1.4 1.6 3 3 4.7 4.1l-2 6A30.5 30.5 0 0 0 20 66l3.4-5.4c2 .7 4 1 6.1 1.2l1.2 6.2c1.8 0 3.5-.1 5.3-.4l.2-6.3c2-.5 4-1.2 6-2.1l4 4.8c1.6-.9 3-1.9 4.4-3l-3-5.6c1.6-1.3 3-3 4.1-4.7l6 2A32 32 0 0 0 60 48l-5.4-3.3c.7-2 1-4.2 1.2-6.2zm-13.5 4a12.5 12.5 0 1 1-22.6-11 12.5 12.5 0 0 1 22.6 11z" />
                                <animateTransform attributeName="transform" begin="0s" dur="3s" from="0 31 37"
                                    repeatCount="indefinite" to="360 31 37" type="rotate" />
                            </g>
                            <g id="small">
                                <path fill="none" stroke="#F44"
                                    d="M93 19.3l6-3c-.4-1.6-1-3.2-1.7-4.8L90.8 13c-.9-1.4-2-2.7-3.4-3.8l2.1-6.3A21.8 21.8 0 0 0 85 .7l-3.6 5.5c-1.7-.4-3.4-.5-5.1-.3l-3-5.9c-1.6.4-3.2 1-4.7 1.7L70 8c-1.5 1-2.8 2-3.9 3.5L60 9.4a20.6 20.6 0 0 0-2.2 4.6l5.5 3.6a15 15 0 0 0-.3 5.1l-5.9 3c.4 1.6 1 3.2 1.7 4.7L65 29c1 1.5 2.1 2.8 3.5 3.9l-2.1 6.3a21 21 0 0 0 4.5 2.2l3.6-5.6c1.7.4 3.5.5 5.2.3l2.9 5.9c1.6-.4 3.2-1 4.8-1.7L86 34c1.4-1 2.7-2.1 3.8-3.5l6.3 2.1a21.5 21.5 0 0 0 2.2-4.5l-5.6-3.6c.4-1.7.5-3.5.3-5.1zM84.5 24a7 7 0 1 1-12.8-6.2 7 7 0 0 1 12.8 6.2z" />
                                <animateTransform attributeName="transform" begin="0s" dur="2s" from="0 78 21"
                                    repeatCount="indefinite" to="-360 78 21" type="rotate" />
                            </g>
                        </svg>
                        <h1>Service Temporarily Unavailable</h1>
                        <br>
                        <h2 class="text-danger">Sorry for the Inconvenience.</h2>
                        <br>
                        <h3>Please be patient, close this window and try again to access this topic. if the problem
                            remains switch to next topic.</h3>

                    </main>
                    <footer><strong> Team <b class="text-info"> Amigos</b></strong></footer>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
    <script src="/js/main.js"></script>
    <script src="/js/jquery.min.js"></script>
    <script src="/js/iziToast.min.js"></script>

    <script>
        document.querySelector('#markAsCompleteBtn').addEventListener('click', function (e) {
            if (parseInt(localStorage.getItem('markDisableButton')) > parseInt(300)) {
                document.querySelector('#markAsCompleteBtn').disabled = true
                const obj = {
                    topicId: '<%=topic.topicId%>'
                }
                fetch('/student/courses/markAsComplete', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(obj)
                }).then(function (res) {
                    return res.json()
                }).then(function (json) {
                    if (json.status === 201) {
                        $('#markAsCompleteBtn').hide()
                        $('#CloseBtn').show()
                    }
                }).catch(err => console.log(err))
            }
            else {

                document.querySelector('#markAsCompleteBtn').disabled = true
                iziToast.error({
                    message: "Please be patient, mark as complete button will on after the time reaches 5 min mark"
                })
            }
        })

        $('#CloseBtn').on('click', function (e) {
            window.top.close()
        })

        let timer2 = "5:00";
        let half = parseInt('<%= topic.duration %> /2');
        let enTimer = parseInt(1)
        let flag = 1
        const interval = setInterval(function () {
            let timer = timer2.split(':');
            let minutes = parseInt(timer[0], 10);
            let seconds = parseInt(timer[1], 10);
            --seconds;
            ++enTimer;
            minutes = (seconds < 0) ? --minutes : minutes;
            if (minutes < 0) clearInterval(interval);
            seconds = (seconds < 0) ? 59 : seconds;
            seconds = (seconds < 10) ? '0' + seconds : seconds;
            $('#counterTimer').html(minutes + ':' + seconds);
            timer2 = minutes + ':' + seconds;
            localStorage.setItem('markDisableButton', flag++)
            if (parseInt(enTimer) == 300) {
                document.querySelector('#markAsCompleteBtn').disabled = false
            }

            if (timer2 == "-1:59") {
                $('#counterTimer').html('completed');
            }

        }, 1000);
    </script>
</body>


</html>
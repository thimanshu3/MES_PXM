<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Inbound PMS</title>
    <meta content='width=device-width, initial-scale=1.0, shrink-to-fit=no' name='viewport' />
    <link rel="icon" href="/assets/img/icon.ico" type="image/x-icon" />

    <!-- CSS Files -->
    <link rel="stylesheet" href="/assets/css/bootstrap.css">
    <link rel="stylesheet" href="/assets/css/atlantis.min.css">

    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link rel="stylesheet" href="/assets/css/demo.css">
    <link rel="stylesheet" href="/assets/css/kk_style.css">
    <link rel="stylesheet" href="/assets/css/iziToast.min.css">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <script src="/assets/js/plugin/webfont/webfont.min.js"></script>
    <script>
        WebFont.load({
            google: {
                "families": ["Lato:300,400,700,900"]
            },
            custom: {
                "families": ["Flaticon", "Font Awesome 5 Solid", "Font Awesome 5 Regular", "Font Awesome 5 Brands", "simple-line-icons"],
                urls: ['/assets/css/fonts.min.css']
            },
            active: function () {
                sessionStorage.fonts = true;
            }
        });
    </script>

    <style>
        #feedback {
            font-size: 1.4em;
        }

        .selectable .ui-selecting {
            background: #FECA40;
        }

        .selectable .ui-selected {
            background: #F39814;
            color: white;
        }

        .selectable {
            list-style-type: none;
            margin: 0;
            padding: 0;
            width: 100%;
        }

        .selectable li {
            margin: 3px;
            padding: 0.4em;
        }

        .current-active{
            border-left: 4px solid;
        }
    </style>


</head>

<body>
    <div class="wrapper">
        <%-include('../partials/config')%>

        <!-- header -->
        <%-include('../partials/header.ejs')%>
        <!-- header end -->

        <!-- Sidebar -->
        <%-include('../partials/sidebar.ejs')%>
        <!-- End Sidebar -->

        <div class="main-panel">
            <div class="content">
                <div class="page-inner ">
                    <div class="page-header">

                        <ul class="breadcrumbs">

                            <li class="nav-home">
                                <a href="/admin/dashboard">
                                    <i class="flaticon-home"></i>
                                </a>
                            </li>
                            <li class="separator">
                                <i class="flaticon-right-arrow"></i>
                            </li>
                            <li class="nav-item">
                                <a href="#">System</a>
                            </li>
                            <li class="separator">
                                <i class="flaticon-right-arrow"></i>
                            </li>
                            <li class="nav-item">
                                <a href="#">User Managment</a>
                            </li>
                            <li class="separator">
                                <i class="flaticon-right-arrow"></i>
                            </li>
                            <li class="nav-item">
                                <a href="#">Users</a>
                            </li>

                        </ul>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card kk_full_form">
                                <div class="card-header">

                                </div>
                                <div class="card-body kK_import_assis_wizard">



                                    <div class="row" style="height:75vh">
                                        <div class="col-2 col-md-2" style="    border-right: 1px solid lightgrey;">
                                            <div class="nav flex-column nav-pills nav-secondary" id="v-pills-tab"
                                                role="tablist" aria-orientation="vertical">
                                                <a class="nav-link active show tick_enable" id="v-pills-1-tab" data-toggle="pill"
                                                    href="#upload-file" role="tab" aria-controls="upload-file"
                                                    aria-selected="true">1. Scan & Upload CSV File</a>
                                                <a class="nav-link tick_enable" id="v-pills-2-tab" data-toggle="pill"
                                                    href="#import-option" role="tab" aria-controls="import-option"
                                                    aria-selected="false">2. Import Options</a>
                                                <a class="nav-link" id="v-pills-3-tab" data-toggle="pill"
                                                    href="#field-mapping" role="tab" aria-controls="v-pills-3"
                                                    aria-selected="false">3. File Mapping</a>
                                                <a class="nav-link" id="v-pills-4-tab" data-toggle="pill"
                                                    href="#v-pills-4" role="tab" aria-controls="v-pills-4"
                                                    aria-selected="false">4. Field Mapping</a>
                                                <a class="nav-link" id="v-pills-5-tab" data-toggle="pill"
                                                    href="#save-step" role="tab" aria-controls="v-pills-5"
                                                    aria-selected="false">5. Save & Start Import</a>
                                            </div>
                                        </div>
                                        <div class="col-10 col-md-10">
                                            <div class="tab-content">
                                                <div class="tab-pane fade active show" id="upload-file" role="tabpanel"
                                                    aria-labelledby="upload-file">
                                                    <form action="/admin/importassistant" method="POST" enctype="multipart/form-data">
                                                        <input type="hidden" name="step" value="1">
                                                   

                                                   

                                                    <div class="form-group d-block " style="    margin: auto;margin-top: 120px;">
                                                        <label class="form-label">Upload File</label>
                                                        <br>
                                                        <label for="et_pb_contact_brand_file_request_0"
                                                            class="et_pb_contact_form_label"></label>
                                                        <input type="file" name="file" id="et_pb_contact_brand_file_request_0"
                                                            class="file-upload">

                                                    </div>

                                                    <ul class="list-inline pull-right">
                                                        <li><button type="submit"
                                                                class="btn next-step btn-primary">Next</button></li>
                                                    </ul>
                                                    </form>
                                                </div>
                                                <div class="tab-pane fade text-center" id="import-option" role="tabpanel"
                                                    aria-labelledby="import-option">
                                                <div class="form-group mt-5" style="width: 60%;">
                                                  <div class="row">
                                                        <div class="col-6 col-sm-4">
                                                            <label class="imagecheck mb-4">
                                                                <input name="imagecheck" type="radio" value="1" class="imagecheck-input">
                                                                <figure class="imagecheck-figure">
                                                                <img src="../../assets/img/add.svg" alt="title" class="imagecheck-image">
                                                                </figure>
                                                            </label>
                                                        </div>
                                                        <div class="col-6 col-sm-4">
                                                            <label class="imagecheck mb-4">
                                                                <input name="imagecheck" type="radio" value="2" class="imagecheck-input" checked="">
                                                                <figure class="imagecheck-figure">
                                                                    <img src="../../assets/img/update.svg" alt="title" class="imagecheck-image">
                                                                </figure>
                                                            </label>
                                                        </div>
                                                        <div class="col-6 col-sm-4">
                                                            <label class="imagecheck mb-4">
                                                                <input name="imagecheck" type="radio" value="3" class="imagecheck-input">
                                                                <figure class="imagecheck-figure">
                                                                    <img src="../../assets/img/addupdate.svg" alt="title" class="imagecheck-image">
                                                                </figure>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>

                                                    <ul class="list-inline pull-right">
                                                        <li><button type="button"
                                                                class="btn prev-step btn-primary">Previous</button></li>
                                                        <li><button type="button"
                                                                class="btn  next-step btn-primary">Next</button></li>
                                                    </ul>
                                                </div>
                                                <div class="tab-pane fade" id="field-mapping" role="tabpanel"
                                                    aria-labelledby="v-pills-3-tab">


                                                    <div class="row">
                                                        <div class="col-md-3">
                                                            <div class="kk_full_form kk_user_form">
                                                                <div class="card-header">
                                                                    <div class="d-flex align-items-center">
                                                                        <h4 class="card-title">Fields From Excel</h4>
                                                                    </div>
                                                                </div>
                                                                <div style="height:600px" class="card-body scroll-area-lg">
                                                                    <ul class="selectable scrollbar-container ps--active-y ps"
                                                                        id="excelFields">
                                                                        <% if(excelData !== null){ %> 
                                                                        <% excelData.forEach(function(field) { %>
                                                                            <% if(field!=null){ %>
                                                                                <li class=""
                                                                                    id="" field-type='excelField'>
                                                                                    <%=field.replace(/\s/g,'') %>
                                                                                </li>
                                                                            <%}%>
                                                                        <% })} %>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-5">

                                                            <div class="kk_full_form kk_user_form">
                                                                <div class="card-header">
                                                                    <div class="d-flex align-items-center">
                                                                        <h4 class="card-title">Preview</h4>

                                                                    </div>
                                                                </div>
                                                                <div class="card-body">
                                                                    <ul id="fieldLinkPreview"
                                                                        style="max-width: 100%;margin: 30px auto;">

                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4">
                                                            <div class=" kk_full_form kk_attribute_set_card kk_newacc ">
                                                                <div class="card-header">

                                                                    <div class="d-flex align-items-center">
                                                                        <h4 class="card-title">System Fields</h4>

                                                                    </div>
                                                                </div>
                                                                <div class="card-body">

                                                                    <div class="accordion accordion-secondary">
                                                                        <div class="card">
                                                                            <div class="card-header" id="headingOne"
                                                                                data-toggle="collapse"
                                                                                data-target="#collapseOne"
                                                                                aria-expanded="true"
                                                                                aria-controls="collapseOne">
                                                                                <div class="span-mode"></div>
                                                                                <div class="span-title">
                                                                                    Item
                                                                                </div>

                                                                            </div>

                                                                            <div id="collapseOne" class="collapse"
                                                                                aria-labelledby="headingOne"
                                                                                data-parent="#accordion">
                                                                                <div class="card-body scroll-area-lg">
                                                                                    <ul id="system-fields"
                                                                                        class="selectable kK_accordian_list scrollbar-container ps--active-y ps">
                                                                                        
                                                                                        <% fields.forEach(function(field) { %>
                                                                                        <li class="ui-widget-content mb-3 p-1 h-100"
                                                                                            id="<%=field.id %>" field-type="<%=field.inputType %>" , field-description="<%=field.description%>">
                                                                                            <%=field.label %>
                                                                                        </li>
                                                                                        <% }) %>
                                                                                    </ul>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                      
                                                                        <div class="card">
                                                                            <div
                                                                                class="card-header collapsed d-flex justify-content-between">
                                                                                <div class="span-mode"></div>
                                                                                <div class="span-title" id="headingTwo"
                                                                                    data-toggle="collapse"
                                                                                    data-target="#collapseVTwo"
                                                                                    aria-expanded="false"
                                                                                    aria-controls="collapseVTwo">
                                                                                    Item Vendors
                                                                                </div>
                                                                                <a id="addVendorBtn"
                                                                                    class="btn btn-light btn-sm p-1"><i
                                                                                        style="font-size:12px"
                                                                                        class="fa fa-plus"></i></a>

                                                                            </div>
                                                                            <div id="collapseVTwo" class="collapse"
                                                                                aria-labelledby="headingTwo"
                                                                                data-parent="#accordion">
                                                                                <div class="card-body">
                                                                                    <ul class="kK_accordian_list">
                                                                                        <li class="acc_collapse">
                                                                                            <div class="accordion accordion-secondary"
                                                                                                id="addVendor">
                                                                                                <div class="card">
                                                                                                    <div class="card-header d-flex justify-content-between"
                                                                                                        id="headingOne"
                                                                                                        data-toggle="collapse"
                                                                                                        data-target="#collapseOne.2v"
                                                                                                        aria-expanded="false"
                                                                                                        aria-controls="collapseOne">
                                                                                                        <div
                                                                                                            class="span-mode">
                                                                                                        </div>
                                                                                                        <div
                                                                                                            class="span-title">
                                                                                                            Item Vendor
                                                                                                            1
                                                                                                        </div>
                                                                                                    </div>
                                                                                                    <div id="collapseOne.2v"
                                                                                                        class="collapse"
                                                                                                        aria-labelledby="headingOne"
                                                                                                        data-parent="#accordion">
                                                                                                        <div
                                                                                                            class="card-body">
                                                                                                            <ul id="vendor-1" onclick="addAll(this)" name="vendor"
                                                                                                                class="ht_logic kK_accordian_list">
                                                                                                                <li field-type="demo1" id="test1">One
                                                                                                                </li>
                                                                                                                <li field-type="demo2" id="test2">Two
                                                                                                                </li>
                                                                                                                <li field-type="demo3" id="test3">Three
                                                                                                                </li>
                                                                                                                <li field-type="demo4" id="test4">Four
                                                                                                                </li>
                                                                                                            </ul>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                </div>


                                                                                            </div>



                                                                                        </li>

                                                                                    </ul>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>


                                                                </div>

                                                            </div>

                                                        </div>

                                                    </div>



                                                    <ul class="list-inline pull-right">
                                                        <li><button type="button"
                                                                class="btn  prev-step btn-primary">Previous</button>
                                                        </li>
                                                        <li><button type="button"
                                                                class="btn  next-step btn-primary">Next</button></li>
                                                    </ul>
                                                </div>

                                                <div class="tab-pane fade" id="v-pills-4" role="tabpanel"
                                                    aria-labelledby="v-pills-4-tab">
                                                    <p>Even the all-powerful Pointing has no control about the blind
                                                        texts it is an almost
                                                        unorthographic
                                                        life One day however a small line of blind text by the name of
                                                        Lorem Ipsum decided
                                                        to leave for the
                                                        far World of Grammar.</p>
                                                    <p>The Big Oxmox advised her not to do so, because there were
                                                        thousands of bad Commas,
                                                        wild Question
                                                        Marks and devious Semikoli, but the Little Blind Text didnâ€™t
                                                        listen. She packed
                                                        her seven
                                                        versalia, put her initial into the belt and made herself on the
                                                        way.
                                                    </p>

                                                    <ul class="list-inline pull-right">
                                                        <li><button type="button"
                                                                class="btn prev-step btn-primary">Previous</button></li>
                                                        <li><button type="button"
                                                                class="btn  next-step btn-primary">Next</button></li>
                                                    </ul>
                                                </div>
                                                <div class="tab-pane fade" id="save-step" role="tabpanel"
                                                    aria-labelledby="v-pills-5-tab">
                                                    <p>Pityful a rethoric question ran over her cheek, then she
                                                        continued her way. On her
                                                        way she met a
                                                        copy. The copy warned the Little Blind Text, that where it came
                                                        from it would have
                                                        been rewritten a
                                                        thousand times and everything that was left from its origin
                                                        would be the word "and"
                                                        and the Little
                                                        Blind Text should turn around and return to its own, safe
                                                        country.</p>

                                                    <p> But nothing the copy said could convince her and so it didnâ€™t
                                                        take long until a
                                                        few insidious Copy
                                                        Writers ambushed her, made her drunk with Longe and Parole and
                                                        dragged her into
                                                        their agency, where
                                                        they abused her for their</p>
                                                    <ul class="list-inline pull-right">
                                                        <li><button type="button"
                                                                class="btn  prev-step btn-primary">Previous</button>
                                                        </li>
                                                        <li><button type="button"
                                                                class="btn  next-step btn-primary">Save</button></li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>




                                </div>

                            </div>
                        </div>
                    </div>








                    <!-- <div class="row">
                        <div class="col-sm-12">
                            <div class="card">
                                <div class="card-header">
                                    <div class="d-flex align-items-center">
                                        <h4 class="card-title">Add Row</h4>
                                        <button class="btn btn-primary btn-round ml-auto" data-toggle="modal"
                                            data-target="#addRowModal">
                                            <i class="fa fa-plus"></i>
                                            Add Row
                                        </button>
                                    </div>
                                </div>

                                <div class="card-body">

                                    <div class="modal fade " id="addRowModal" tabindex="-1" role="dialog">
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header no-bd">
                                                    <h5 class="modal-title">
                                                        <span class="fw-mediumbold">
                                                            New</span>
                                                        <span class="fw-light">
                                                            Row
                                                        </span>
                                                    </h5>
                                                    <button type="button" class="close" data-dismiss="modal"
                                                        aria-label="Close">
                                                        <span aria-hidden="true">×</span>
                                                    </button>
                                                </div>
                                                <div class="modal-body">
                                                    <p class="small">Create a new row using this form, make sure you
                                                        fill them all</p>
                                                    <form>
                                                        <div class="row">
                                                            <div class="col-sm-12">
                                                                <div class="form-group form-group-default">
                                                                    <label>Name</label>
                                                                    <input id="addName" type="text" class="form-control"
                                                                        placeholder="fill name">
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6 pr-0">
                                                                <div class="form-group form-group-default">
                                                                    <label>Position</label>
                                                                    <input id="addPosition" type="text"
                                                                        class="form-control"
                                                                        placeholder="fill position">
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <div class="form-group form-group-default">
                                                                    <label>Office</label>
                                                                    <input id="addOffice" type="text"
                                                                        class="form-control" placeholder="fill office">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </form>
                                                </div>
                                                <div class="modal-footer no-bd">
                                                    <button type="button" id="addRowButton"
                                                        class="btn btn-primary">Add</button>
                                                    <button type="button" class="btn btn-danger"
                                                        data-dismiss="modal">Close</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                    <table id="add-row" class="display table table-striped table-hover dataTable"
                                        role="grid" aria-describedby="add-row_info">
                                        <thead>
                                            <tr>
                                                <th rowspan="1" colspan="1">Name</th>
                                                <th rowspan="1" colspan="1">Position</th>
                                                <th rowspan="1" colspan="1">Office</th>
                                                <th rowspan="1" colspan="1">Action</th>
                                            </tr>
                                        </thead>
                                        <tr>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td>

                                            </td>

                                        </tr>
                                        <tbody>

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div> -->

                </div>
            </div>
            <%-include('../partials/footer.ejs')%>
            <div class="modal fade kk_modal_popup_form" id="exampleModal" style="display: none;" aria-hidden="true"
                data-keyboard="false" data-backdrop="static">
                <div class="modal-dialog ">
                    <div class="modal-content">

                        <!-- Modal Header -->
                        <div class="modal-header">
                            <h4 class="modal-title mr-3">Default Value of <strong style="color: blue" id="dmodal-default"></strong></h4>
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>
                        <form action="" method="POST" enctype="multipart/form-data">
                            <!-- Modal body -->
                            <div class="modal-body">
                                <div class="form-group">
                                    <label class="form-label">Choose a value to assign in this field</label>

                                </div>

                                <div class="form-group">
                                    <div class="selectgroup w-100">
                                        <label class="selectgroup-item">
                                            <input type="radio" name="value" value="50" class="selectgroup-input"
                                                checked="">
                                            <span class="selectgroup-button">Provide default value</span>
                                        </label>
                                        <label class="selectgroup-item">
                                            <input type="radio" name="value" value="100" class="selectgroup-input">
                                            <span class="selectgroup-button">Set value to null</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="form-group text-center">
                                    <div class="selectgroup selectgroup-pills">
                                        <label class="selectgroup-item">
                                            <input type="radio" name="transportation" value="2"
                                                class="selectgroup-input">
                                            <span class="selectgroup-button selectgroup-button-icon">Yes</span>
                                        </label>
                                        <label class="selectgroup-item">
                                            <input type="radio" name="transportation" value="1"
                                                class="selectgroup-input">
                                            <span class="selectgroup-button selectgroup-button-icon">No</span>
                                        </label>

                                    </div>
                                </div>


                                <div class="form-group">
                                    <select class="form-control form-control" id="defaultSelect">
                                        <option>1</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5</option>
                                    </select>
                                </div>


                                <div class="form-group">
                                    <select multiple="" class="form-control" id="exampleFormControlSelect2">
                                        <option>1</option>
                                        <option>2</option>
                                        <option>3</option>
                                        <option>4</option>
                                        <option>5</option>
                                    </select>
                                </div>


                            </div>

                            <!-- Modal footer -->
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-primary">Save</button>
                                <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <!--   Core JS Files   -->
    <script src="/assets/js/clientScript.js"></script>

    <!-- jQuery library -->
    <script src="/assets/js/core/jquery.3.2.1.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="/assets/js/core/bootstrap.js"></script>

    <!-- Atlantis JS -->
    <script src="/assets/js/atlantis.min.js"></script>
    <script src="/assets/js/iziToast.js"></script>
    <script src="/assets/js/flashMessage.js"></script>
    <!-- Datatables -->
    <script src="/assets/js/plugin/datatables/datatables.min.js"></script>
    <!-- Popper JS -->
    <script src="/assets/js/core/popper.min.js"></script>
    <!-- jQuery UI -->
    <script src="/assets/js/plugin/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
    <script src="/assets/js/plugin/jquery-ui-touch-punch/jquery.ui.touch-punch.min.js"></script>

    <!-- jQuery Scrollbar -->
    <script src="/assets/js/plugin/jquery-scrollbar/jquery.scrollbar.min.js"></script>
    <script src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"></script>



    <script>
        let counter = 0;
        var current = null;
        $(function () {
            // right
            $("#system-fields").selectable({
                selected: function (event, ui) {
                    previewMapped(ui, 'right')
                }
            });

            // left
            $("#excelFields").selectable({
                selected: function (event, ui) {
                    console.log(event, ui);
                    previewMapped(ui, 'left')
                }
            });

            

             $("#fieldLinkPreview").selectable({
                selected: function (event, ui) {
                    current = ui.selected.getAttribute('id')
                  
                }
            })
        });

        $(document).ready(function () {
            if ($('#fieldLinkPreview').children().length == 0) {
                $('#fieldLinkPreview').append(`
                     <div id="nofield" class="mx-auto Kk_no_assigned">
                        <img class="img-responsive"
                            src="/assets/img/no_field_assigned.png">
                        <h4>No Fields Mapped</h4>
                        <h6>Please Map some fields to continue</h6>
                    </div>
                `)
            }

            var action = '<td> <div class="form-button-action"> <button type="button" data-toggle="tooltip" title="" class="btn btn-link btn-primary btn-lg" data-original-title="Edit Task"> <i class="fa fa-edit"></i> </button> <button type="button" data-toggle="tooltip" title="" class="btn btn-link btn-danger" data-original-title="Remove"> <i class="fa fa-times"></i> </button> </div> </td>';

            $('#addRowButton').click(function () {
                $('#add-row').dataTable().fnAddData([
                    $("#addName").val(),
                    $("#addPosition").val(),
                    $("#addOffice").val(),
                    action
                ]);
                $('#addRowModal').modal('hide');

            });
        });


        var flag = true;
        var left = false;
        var right = true;
        var prev;

        function closeNav(id) {
            $(`#${id}`).remove();
            if ($('#fieldLinkPreview').children().length == 1) {
                $('#fieldLinkPreview').append(`
                     <div id="nofield" class="mx-auto Kk_no_assigned">
                        <img class="img-responsive"
                            src="/assets/img/no_field_assigned.png">
                        <h4>No Fields Mapped</h4>
                        <h6>Please Map some fields to continue</h6>
                    </div>
                `)
            }
        }

        const previewMapped = (li, type) => {
            var list = li
            console.log(list.selected);
            $('#nofield').hide();
            if(current===null) {
               //send id . field-type and field-name in show modal function
                if (type=='left') {
                    $('#fieldLinkPreview').append(`<li id="preview-${counter}" class="kkay_field_map_link">  
                        
                <div class="k_field" id='left-${counter}'> ${li.selected.innerText || li.selected.innerHTML}</div>
                 <i class="fas fa-arrows-alt-h"></i>
                 <div id='right-${counter}' class="k_field"> </div>
                <a href="javascript:void(0)" class="closebtn" onclick="closeNav('preview-${counter}')" style="z-index:999"><i class="fas fa-times-circle"></i></a>
               
                 </li>`)
                }
                else if(type=='right') {
                    $('#fieldLinkPreview').append(`<li id="preview-${counter}" class="kkay_field_map_link">
                          <a id="a-${counter}" onclick="showModal('${list.selected.getAttribute('id')}','${list.selected.getAttribute('field-type')}','${list.selected.innerText}')" class="btn btn-sm btn-light" style="z-index:999"><i class="fas fa-edit"></i></a>
                <div class="k_field" id='left-${counter}'> </div>
                 <i id='arrow-${counter}' style="color:green" class="fas fa-arrows-alt-h"></i>
                 <div id='right-${counter}' class="k_field">${li.selected.innerText || li.selected.innerHTML} </div>
                <a href="javascript:void(0)" class="closebtn" onclick="closeNav('preview-${counter}')" style="z-index:999"><i class="fas fa-times-circle"></i></a>
                               

                 </li>`)
                }
                counter+=1
                $('#fieldLinkPreview').append(`<li id="preview-${counter}" class="kkay_field_map_link">
                         
                <div class="k_field" id='left-${counter}'> </div>
                 <i id='arrow-${counter}' class="fas fa-arrows-alt-h"></i>
                 <div id='right-${counter}' class="k_field"> </div>
                <a href="javascript:void(0)" class="closebtn mr-3" onclick="closeNav('preview-${counter}')" style="z-index:999"><i class="fas fa-times-circle"></i></a>
                 

                 </li>`)
                
                 $(`#preview-${counter}`).addClass('ui-selectee ui-selected').siblings().removeClass('ui-selectee ui-selected')
                 current = "preview-"+counter
                 $('#fieldLinkPreview li').each(function (i) {
                    $(this).removeClass('current-active');
                });
                  $(`#preview-${counter-1}`).addClass('current-active')
                 
            }
        else{
            let n = current.slice(-1)
            let leftElement= document.getElementById(`left-${n}`)
            let rightElement= document.getElementById(`right-${n}`)
            $('#fieldLinkPreview li').each(function (i) {
                    $(this).removeClass('current-active');
                });
            $(`#preview-${counter - 1}`).addClass('current-active')
            let isEmptyRow = ((leftElement.innerText == '' && rightElement.innerText == '')? true:false)
            if (type=='right') {
                rightElement.innerText = li.selected.innerText;
                if($(`#preview-${n}`).find("i.fa-edit").length==0)
                    $(`#preview-${n}`).prepend(`<a id="a-${n}" onclick="showModal('${list.selected.getAttribute('id')}','${list.selected.getAttribute('field-type')}','${list.selected.innerText}')" class="btn btn-sm btn-light" style="z-index: 999;"><i class="fas fa-edit"></i></a>`);
                else
                    $(`#a-${n}`).attr("onclick", `showModal('${list.selected.getAttribute('id')}','${list.selected.getAttribute('field-type')}','${list.selected.innerText}')`)
            }
            else if(type=='left') {
               leftElement.innerText = li.selected.innerText;
            }
            if(isEmptyRow){
                counter += 1
                $('#fieldLinkPreview').append(`<li id="preview-${counter}" class="kkay_field_map_link">
                    
                <div class="k_field" id='left-${counter}'> </div>
                <i id='arrow-${counter}' class="fas fa-arrows-alt-h"></i>
                <div id='right-${counter}' class="k_field"> </div>
                <a href="javascript:void(0)" class="closebtn mr-3" onclick="closeNav('preview-${counter}')" style="z-index:999"><i class="fas fa-times-circle"></i></a>
                               

                </li>`)
                 $('#fieldLinkPreview li').each(function (i) {
                    $(this).removeClass('current-active');
                });
                $(`#preview-${counter - 1}`).addClass('current-active')
                $(`#preview-${counter}`).addClass('ui-selectee ui-selected').siblings().removeClass('ui-selectee ui-selected')
                current = "preview-" + counter
                
            }
           
        }
        }
       

        $('#addVendorBtn').on('click', function () {
            $('#addVendor').append(`
        <div class="card">
            <div class="card-header d-flex justify-content-between" id="headingOne" data-toggle="collapse"
                data-target="#collapseOne.2-v${$('#addVendor').children().length + 1}" aria-expanded="false" aria-controls="collapseOne">
                <div class="span-mode"></div>
                <div class="span-title">
                    Item Vendor ${$('#addVendor').children().length + 1}
                </div>
            </div>
            <div id="collapseOne.2-v${$('#addVendor').children().length + 1}" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
                <div class="card-body">
                    <ul name="vendor" onclick="addAll(this)" id="vendor-${$('#addVendor').children().length + 1}" class="kK_accordian_list ht_logic">
                        <li field-type="demo1" id="test1">One</li>
                        <li field-type="demo2" id="test2">Two</li>
                        <li field-type="demo3" id="test3">Three</li>
                        <li field-type="demo4" id="test4">Four</li>
                    </ul>
                </div>
            </div>
        </div>
        `)
        })

        const addAll = (content) =>{
            let child = Array.from(content.children)
            $('#nofield').hide();
            $('#fieldLinkPreview li:last-child').remove();
            counter -=1
            child.forEach((item,i) => {
                console.log(item, i);
                $('#fieldLinkPreview').append(`<li name="__${content.id}" id="preview-${counter}" class="kkay_field_map_link">
                <div class="k_field" id='left-${counter}'> </div>
                 <i id='arrow-${counter}' class="fas fa-arrows-alt-h"></i>
                 <div id='right-${counter}' class="k_field">Item ${content.id} : ${item.innerText}</div>
                <a href="javascript:void(0)" class="closebtn" onclick="closeNav('preview-${counter}')"><i class="fas fa-times-circle"></i></a>
                 </li>`)
                if ($(`#preview-${counter}`).find("i.fa-edit").length == 0)
                    $(`#preview-${counter}`).prepend(`<a id="a-${counter}" onclick="showModal('${item.getAttribute('id')}','${item.getAttribute('field-type')}','${item.innerText}')" class="btn btn-sm btn-light" style="z-index: 999;"><i class="fas fa-edit"></i></a>`);
                else
                    $(`#a-${counter}`).attr("onclick", `showModal('${item.getAttribute('id')}','${item.getAttribute('field-type')}','${item.innerText}')`)
                 counter+=1
            });
            // let leftElement = document.getElementById(`left-${counter}`)
            // let rightElement = document.getElementById(`right-${counter}`)
            // let isEmptyRow = ((leftElement.innerText == '' && rightElement.innerText == '') ? true : false)
            // if (isEmptyRow) {}
            $('#fieldLinkPreview').append(`<li id="preview-${counter}" class="kkay_field_map_link">
                <div class="k_field" id='left-${counter}'> </div>
                 <i id='arrow-${counter}' class="fas fa-arrows-alt-h"></i>
                 <div id='right-${counter}' class="k_field"> </div>
                <a href="javascript:void(0)" class="closebtn" onclick="closeNav('preview-${counter}')"><i class="fas fa-times-circle"></i></a>
                 </li>`)
        }
      

        // Javascript to enable link to tab
        let step = '<%= step%>'
        if(step){
            $('.nav a[href="#' + step + '"]').tab('show'); 
        }
            var hash = location.hash.replace(/^#/, '');
            if (hash) {
                $('.nav a[href="#' + hash + '"]').tab('show');
               $('html, body').animate({ scrollTop: '0px'}, 10);
            }

            // Change hash for page-reload
            $('.nav a').on('shown.bs.tab', function (e) {
                window.location.hash = e.target.hash;
                $('html, body').animate({ scrollTop: '0px' },10);
            })

        const showModal = function(id,type,name){
            console.log(id, type, name);
            $('#dmodal-default').text(' '+name);
            
            $('#dmodal-body').append(`
            
            `)
            $('#exampleModal').modal('show')
        }

        //Issues:
        // Duplicate id when we add vendor and item fields.
        // If initially we add a vendor group and then an item field then one empty row is present.
        // Highlight current selected row in preview section.

        //Next -->
        //Delete all items of a selected vendor group (indentifiable by name starting with '__').
    </script>

</body>

</html>
